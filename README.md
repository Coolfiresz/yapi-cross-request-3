# Cross-Request - YApiè·¨åŸŸè¯·æ±‚Chromeæ‰©å±•3.0ç‰ˆæœ¬

cross-requestæ˜¯ä¸€ä¸ªèµ‹äºˆhtmlé¡µé¢è·¨åŸŸè¯·æ±‚èƒ½åŠ›çš„Chromeæ‰©å±•ï¼Œä¸“ä¸ºé…åˆYApiæ¥å£æµ‹è¯•å¹³å°ä½¿ç”¨ã€‚

## ğŸ¯ é¡¹ç›®ä¸»è¦ç›®çš„

**æœ¬é¡¹ç›®ä¸»è¦è§£å†³Chromeæ‰©å±•Manifest V2åˆ°V3çš„ç‰ˆæœ¬å‡çº§é—®é¢˜ã€‚**

ç”±äºChromeæµè§ˆå™¨è¿‘æœŸå¼ºåˆ¶ä¸‹æ¶äº†æ‰€æœ‰åŸºäºManifest V2çš„æ‰©å±•æ’ä»¶ï¼Œå¯¼è‡´åŸæœ‰çš„cross-requestæ’ä»¶æ— æ³•ç»§ç»­ä½¿ç”¨ï¼Œè¿›è€Œä½¿å¾—YApiçš„æ‰€æœ‰æ¥å£è°ƒè¯•åŠŸèƒ½éƒ½æ— æ³•æ­£å¸¸å·¥ä½œã€‚æœ¬é¡¹ç›®å°†æ’ä»¶å‡çº§åˆ°Manifest V3ç‰ˆæœ¬ï¼Œç¡®ä¿YApiç”¨æˆ·èƒ½å¤Ÿç»§ç»­åœ¨Chromeæµè§ˆå™¨ä¸Šæ­£å¸¸è¿›è¡Œæ¥å£æµ‹è¯•ã€‚

### ä¸ºä»€ä¹ˆéœ€è¦å‡çº§åˆ°V3ï¼Ÿ

1. Chromeå®˜æ–¹å·²åœæ­¢å¯¹Manifest V2æ‰©å±•çš„æ”¯æŒ
2. æ‰€æœ‰V2ç‰ˆæœ¬çš„æ‰©å±•å·²è¢«å¼ºåˆ¶ä¸‹æ¶
3. ä¸å‡çº§å°†å¯¼è‡´YApiçš„è·¨åŸŸè¯·æ±‚åŠŸèƒ½å®Œå…¨å¤±æ•ˆ
4. å‡çº§åˆ°V3æ˜¯ç»§ç»­ä½¿ç”¨è¯¥æ’ä»¶çš„å”¯ä¸€é€”å¾„

## é™„åŠ åŠŸèƒ½è¯´æ˜

é™¤äº†ç‰ˆæœ¬å‡çº§ï¼Œæœ¬æ’ä»¶è¿˜è§£å†³äº†ä»¥ä¸‹é—®é¢˜ï¼š

### 1. è§£å†³cross-requestä¸æ”¯æŒæ–‡ä»¶ä¸Šä¼ çš„é—®é¢˜

Chromeåœ¨73ç‰ˆæœ¬åï¼Œé™åˆ¶äº†content-scriptè·¨åŸŸè¯·æ±‚ã€‚ç›®å‰åªæœ‰ä¸€ä¸ªè§£å†³åŠæ³•ï¼ŒåºŸå¼ƒcontent-scriptè·¨åŸŸè¯·æ±‚ï¼Œä½¿ç”¨background.jsæ‰§è¡Œè·¨åŸŸè¯·æ±‚ï¼Œä½†è¿™æ ·æœ‰ä¸ªæœ€å¤§çš„é—®é¢˜æ˜¯æ— æ³•æ”¯æŒæ–‡ä»¶ä¸Šä¼ ã€‚

**æœ¬æ’ä»¶å·²ç»ä¿®å¤äº†æ–‡ä»¶ä¸Šä¼ çš„é—®é¢˜ï¼Œä½ å¯ä»¥ç›´æ¥ä¸‹è½½ä»£ç ï¼Œä½¿ç”¨Chromeå¼€å‘è€…æ¨¡å¼åŠ è½½æºç è¿›è¡Œå®‰è£…ã€‚**

### 2. è§£å†³Yapiæµ‹è¯•é›†åˆä¸æ”¯æŒæ–‡ä»¶ä¸Šä¼ çš„é—®é¢˜

å¯¹äºæµ‹è¯•é›†åˆä¸­åŒ…å«æ–‡ä»¶ä¸Šä¼ çš„æ¥å£æ—¶ï¼Œæ”¶åˆ°çš„ä¸Šä¼ æ–‡ä»¶æ€»æ˜¯ä¸ºç©ºã€‚å› ä¸ºYapiä¸èƒ½æ­£ç¡®æ”¯æŒæ–‡ä»¶ä¸Šä¼ ã€‚

**è§£å†³æ€è·¯:** å°†æ–‡ä»¶å†…å®¹è½¬æ¢æˆBase64çš„å­—ç¬¦ä¸²ï¼Œè¿™æ ·æ–‡ä»¶å†…å®¹å°±å¯ä»¥ä»¥å­—ç¬¦ä¸²çš„å½¢å¼ä¿å­˜åœ¨æ•°æ®åº“äº†ã€‚

éœ€è¦å¯¹Yapiå’Œcross-requestæ’ä»¶è¿›è¡Œä¿®æ”¹ï¼Œ**ç›®å‰æ­¤æ’ä»¶å·²æ”¯æŒæœ¬åŠŸèƒ½**ã€‚

#### ä½¿ç”¨æ–¹å¼ï¼š

1. ä¿®æ”¹Yapié¡¹ç›®æºç ï¼Œ`./client/containers/Project/Interface/InterfaceList/InterfaceEditForm`ä¸­`isfile`çš„åˆ¤æ–­æ¡ä»¶ï¼Œå¢åŠ å¯¹base64æ–‡ä»¶çš„åˆ¤æ–­

   ```
   if (values.req_body_type === 'form') {
               values.req_body_form.forEach(item => {
                 if (item.type === 'file' || (item.value !== undefined && /data.*base64/.test(item.value))) {
                   isfile = true;
                 }
               });
   ```

   

2. ç¼–è¾‘æ¥å£æ—¶Bodyä½“é€‰æ‹©formç±»å‹ï¼Œæ–‡ä»¶å­—æ®µç±»å‹é€‰æ‹©`text`ï¼Œå‚æ•°å€¼æ˜¯æ–‡ä»¶è½¬base64åçš„å€¼ï¼Œéœ€è¦å‰ç¼€`data:text/plain;base64,`ç”¨æ¥è§£ææ–‡ä»¶ç±»å‹

   ![](https://github.com/xiuxiuing/cross-request/blob/master/img/edit.png)

3. å®‰è£…ä½¿ç”¨æœ¬é¡¹ç›®çš„cross-requestæ’ä»¶ï¼Œæ’ä»¶ä¼šå…ˆæŠŠbase64æ•°æ®è½¬æ¢æˆæ–‡ä»¶å†è¯·æ±‚Serverã€‚

è¿™æ ·ï¼Œæ¥å£ä¿å­˜åˆ°æµ‹è¯•é›†åˆä¸­ä¹Ÿæ”¯æŒæ–‡ä»¶ä¸Šä¼ åŠŸèƒ½äº†ã€‚

## Chromeå®‰è£…cross-requestæ­¥éª¤

1. ç‚¹å‡»`Code`ä¸‹è½½æºç 
   
    ![](https://github.com/xiuxiuing/cross-request/blob/master/img/downcode.png)
2. è§£å‹æºç åï¼ŒæŠŠæºç æ”¾ç½®åˆ°å¯ä¿¡ä½ç½®ï¼Œ**æºç æ–‡ä»¶å¤¹ä¸å¯åˆ é™¤**
3. Chromeæµè§ˆå™¨åœ°å€æ ä¸­è¾“å…¥`chrome://extensions/`ï¼Œè¿›å…¥æ‰©å±•ç¨‹åºé¡µé¢
4. æ‰“å¼€ã€å¼€å‘è€…æ¨¡å¼ã€‘->ã€åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åºã€‘->ã€é€‰æ‹©æ–‡ä»¶å¤¹ã€‘å®‰è£…æ’ä»¶
   
    ![](https://github.com/xiuxiuing/cross-request/blob/master/img/installcode.png)
5. æ’ä»¶å®‰è£…å®Œæˆï¼Œåˆ·æ–°é¡µé¢å³å¯ä½¿ç”¨ã€‚

**æ¬¢è¿ç‚¹å‡»Staræ”¯æŒä¸€ä¸‹ï¼Œæœ‰é—®é¢˜å¯ä»¥æIssuesäº¤æµ**

## API ä½¿ç”¨æ–‡æ¡£

### Api
crossRequest( options )

### Usageç¤ºä¾‹
1. GET
```
crossRequest({
    url: 'http://caibaojian.com/ajax-jsonp.html',
    method: 'GET',
    success: function(res, header){

    }
})
```
2. POST
```
    crossRequest({
        url: 'http://127.0.0.1:3000/api',
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        data: {
            a: 1,
            b: 2,
            c: {
                t: 1
            }
        },
        success: function (res) {
            console.log(arguments)
        }
    })
```
3. FILE upload
```
    crossRequest({
        url: 'http://127.0.0.1:8081/upload',
        method: 'POST',
        data: {
            name: 'hello',
            id: '19'
        },
        files: {
            file: 'fileId' //File Upload-Input dom id
        },
        success: function (res) {
            alert(res)
        }
    })
```
